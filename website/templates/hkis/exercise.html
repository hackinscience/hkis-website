{% extends "hkis/layout.html" %}
{% load i18n %}
{% load static %}{% load md2 %}{% load bootstrap4 %}
{% block body %}
<div class="container">
  <a href="{% url "exercises" %}">
    Back
  </a>

  {{ object.wording|markdown:"fenced-code-blocks" }}

  <hr>
  <div class="row">
    <div class="col-md-8">
      <h2>Your Code</h2>
    </div>
    <div class="col-md-4">
      <h2>Results</h2>
      <div class="result">
        <table  class="table">
          {% for answer in object.answers.all %}
          {% if not answer.is_corrected %}
          <tr>
            <td><img src="{% static "img/loading_anim.gif" %}" height=30> Waiting for correction</td>
          </tr>
          {% else %}
          <tr>
            <td><pre>{{ answer.correction_message }}</pre></td>
          </tr>
          {% endif %}
          {% endfor %}
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  setInterval(function(){
    $.get( "/exercise/{{ object.id }}/checkall", function( data ) {
      var res = '<table class="table">';
      data.forEach(function(element) {
        res += '<tr>';
        if (element[2] == null ){
          res += '<td><img src="{% static "img/loading_anim.gif" %}" height="30"> Waiting for correction</td>';
        } else {
          element[2] = String(element[2]).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;')
          res += '<td><pre>' + element[2] + '</pre></td>';
            }
            res += '</tr>';
          });
          //res += data;
          res += '</table';
        $( ".result" ).html( res );
        console.log( "Load was performed." );
        })
        }  , 5000);
</script>
{% endblock %}
